cdmx_2015 %>%
select(seccion, distrito, c_pri_pvem:cand_ind_2) %>%
filter_at(vars(c_pri_pvem:cand_ind_2), any_vars(. == "-")) %>%
group_by(seccion) %>%
count()
cdmx_2015 %>%
select(seccion, distrito, c_pri_pvem:cand_ind_2) %>%
filter_at(vars(c_pri_pvem:cand_ind_2), any_vars(. == "-")) %>%
group_by(seccion)
cdmx_2015 %>%
select(seccion, distrito, c_pri_pvem:cand_ind_2) %>%
filter_at(vars(c_pri_pvem:cand_ind_2), any_vars(. != "-")) %>%
group_by(seccion)
cdmx_2015 %>%
select(seccion, distrito, c_pri_pvem:cand_ind_2) %>%
filter_at(vars(c_pri_pvem:cand_ind_2), all_vars(. != "-")) %>%
group_by(seccion)
cdmx_2015 %>%
select(seccion, distrito, cand_ind_2:cand_ind_2) %>%
filter_at(vars(c_pri_pvem:cand_ind_2), all_vars(. == "-")) %>%
group_by(seccion)
cdmx_2015 %>%
select(seccion, distrito, cand_ind_1:cand_ind_2) %>%
filter_at(vars(cand_ind_1:cand_ind_2), any_vars(. != "-")) %>%
group_by(seccion)
cdmx_2015 %>%
select(seccion, distrito, c_pri_pvem:cand_ind_2) %>%
filter_at(vars(c_pri_pvem:cand_ind_2), any_vars(. != "-")) %>%
group_by(seccion)
cdmx_2015 %>%
select(seccion, distrito, cand_ind_1:cand_ind_2) %>%
filter_at(vars(cand_ind_1:cand_ind_2), any_vars(. != "-")) %>%
group_by(seccion)
cdmx_2015 %>%
select(seccion, distrito, cand_ind_1:cand_ind_2) %>%
filter_at(vars(cand_ind_1:cand_ind_2), any_vars(. != "-")) %>%
group_by(seccion) %>%
filter(cand_ind_2 != "-")
cdmx_2015 <- cdmx_2015 %>%
select(-cand_ind_2)
glimpse(cdmx_2015)
?colsums
?colSums
porcentajes <- cdmx_2015 %>%
select(pan:nulos) %>%
colSums()
?ifelse
cdmx_2015[cand_ind_1] <- ifelse(cdmx_2015$cand_ind_1 == "-", NA, cdmx_2015$cand_ind_1)
cdmx_2015$cand_ind_1 <- ifelse(cdmx_2015$cand_ind_1 == "-", NA, cdmx_2015$cand_ind_1)
glimpse(cdmx_2015)
cdmx_2015 %>% select(cand_ind_1) %>% distinct()
?colSums
porcentajes <- cdmx_2015 %>%
select(pan:nulos) %>%
colSums(na.rm = TRUE)
colSums(cdmx_2015, na.rm = TRUE)
glimpse(select(cdmx_2015, pan:nulos))
cdmx_2015$c_pri_pvem <- as.integer(cdmx_2015$c_pri_pvem)
glimpse(cdmx_2015)
full_2015 %>% filter(estado == 9) %>% select(c_pri_pvem) %>% distinct()
x <-  full_2015 %>% filter(estado == 9) %>% select(c_pri_pvem) %>% distinct()
x
x <- as.character(x)
x
cdmx_2015 <- full_2015 %>%
filter(estado == 9) %>%
select(seccion, distrito, 12:28)
problematic_data <- problems(cdmx_2015)
number_automatic_problems <- problematic_data %>%
select(row) %>%
unique() %>%
nrow()
cdmx_2015 %>%
select(seccion, distrito, c_pri_pvem:c_prd_pt) %>%
filter_at(vars(c_pri_pvem:cand_ind_2), any_vars(. != "-")) %>%
group_by(seccion)
glimpse(cdmx_2015)
cdmx_2015 %>%
select(seccion, distrito, c_pri_pvem:c_prd_pt) %>%
filter_at(vars(c_pri_pvem:cand_ind_2), any_vars(. != "-")) %>%
group_by(seccion)
cdmx_2015 <- full_2015 %>%
filter(estado == 9) %>%
select(seccion, distrito, 12:28)
cdmx_2015 <- full_2015 %>%
filter(estado == 9) %>%
select(seccion, distrito, 12:28)
rm(cdmx_2015)
cdmx_2015 <- full_2015 %>%
filter(estado == 9) %>%
select(seccion, distrito, 12:28)
cdmx_2015 %>%
select(seccion, distrito, c_pri_pvem:c_prd_pt) %>%
filter_at(vars(c_pri_pvem:cand_ind_2), any_vars(. != "-")) %>%
group_by(seccion)
glimpse(cdmx_2015)
cdmx_2015 %>%
select(seccion, distrito, c_pri_pvem:c_prd_pt) %>%
filter_at(vars(c_pri_pvem:c_prd_pt), any_vars(. != "-")) %>%
group_by(seccion)
cdmx_2015 %>%
select(seccion, distrito, c_pri_pvem:c_prd_pt) %>%
filter_at(vars(c_pri_pvem:c_prd_pt), any_vars(. == "-")) %>%
group_by(seccion)
cdmx_2015 %>%
select(seccion, distrito, c_pri_pvem:c_prd_pt) %>%
filter_at(vars(c_pri_pvem:c_prd_pt), any_vars(. != "-")) %>%
group_by(distrito)
cdmx_2015 %>%
select(distrito, c_pri_pvem, c_prd_pt) %>%
filter_at(vars(c_pri_pvem:c_prd_pt), any_vars(. == "-")) %>%
group_by(distrito)
rm(x)
arreglar_guiones <- function(x){
return(elseif(x == "-", NA, x))
}
glimpse(cdmx_2015)
cdmx_2015 <- cdmx_2015 %>%
select(-cand_ind_2)
?mutate_all
cdmx_2015 %>%
select(c_pri_pvem:cand_ind_1) %>%
mutate_all(. = arreglar_guiones(.))
cdmx_2015 %>%
select(c_pri_pvem:cand_ind_1) %>%
mutate_all(arreglar_guiones(.))
arreglar_guiones <- function(x){
return(ifelse(x == "-", NA, x))
}
cdmx_2015 %>%
select(c_pri_pvem:cand_ind_1) %>%
mutate_all(arreglar_guiones(.))
cdmx_2015 %>%
mutate_at(vars(c_pri_pvem:cand_ind_1), arreglar_guiones())
arreglar_guiones <- function(x){
return(ifelse((x == "-"), NA, x))
}
test = c("1", "3", "-", " ", "5")
arreglar_guiones(test)
cdmx_2015 %>%
mutate_at(vars(c_pri_pvem:cand_ind_1), arreglar_guiones())
arreglar_guiones(cdmx_2015$c_prd_pt)
arreglar_guiones(cdmx_2015$c_pri_pvem)
arreglar_guiones(cdmx_2015$cand_ind_1)
cdmx_2015 %>%
mutate_at(vars(c_pri_pvem:cand_ind_1), arreglar_guiones)
cdmx_2015 %>%
mutate_at(vars(c_pri_pvem:cand_ind_1), arreglar_guiones) %>%
glimpse()
x
test
y <- arreglar_guiones(test)
as.numeric(y)
cdmx_2015 %>%
mutate_at(vars(c_pri_pvem:cand_ind_1), arreglar_guiones) %>%
mutate_at(vars(c_pri_pvem:cand_ind_1),function(x) trycatch(arreglar_guiones(x)))
cdmx_2015 %>%
mutate_at(vars(c_pri_pvem:cand_ind_1), arreglar_guiones) %>%
mutate_at(vars(c_pri_pvem:cand_ind_1),function(x) tryCatch(arreglar_guiones(x)))
cdmx_2015 %>%
mutate_at(vars(c_pri_pvem:cand_ind_1), arreglar_guiones) %>%
mutate_at(vars(c_pri_pvem:cand_ind_1),function(x) tryCatch(arreglar_guiones(x))) %>%
glimpse()
knitr::opts_chunk$set(echo = TRUE)
library(dplyr)
library(readr)
library(tidyr)
rm(list = ls())
full_2015 <- read_delim("data/diputados_2015.csv", delim = "|", col_names = TRUE, skip = 5)
names(full_2015) <- full_2015 %>%
names() %>%
tolower()
cdmx_2015 <- full_2015 %>%
filter(estado == 9) %>%
select(seccion, distrito, 12:28)
problematic_data <- problems(cdmx_2015)
number_automatic_problems <- problematic_data %>%
select(row) %>%
unique() %>%
nrow()
problematic_data %>% pull(col) %>% unique()
names(full_2015) <- full_2015 %>%
names() %>%
tolower()
problematic_data <- problems(cdmx_2015)
number_automatic_problems <- problematic_data %>%
select(row) %>%
unique() %>%
nrow()
problematic_data %>% pull(col) %>% unique()
names(full_2015) <- full_2015 %>%
names() %>%
tolower()
cdmx_2015 <- full_2015 %>%
filter(estado == 9) %>%
select(seccion, distrito, 12:28)
problematic_data <- problems(cdmx_2015)
number_automatic_problems <- problematic_data %>%
select(row) %>%
unique() %>%
nrow()
problematic_data %>% pull(col) %>% unique()
glimpse(cdmx_2015)
problematic_data <- problems(cdmx_2015)
number_automatic_problems <- problematic_data %>%
select(row) %>%
unique() %>%
nrow()
problematic_data %>% pull(col) %>% unique()
cdmx_2015 %>%
select(distrito, c_pri_pvem:c_prd_pt) %>%
filter_at(vars(c_pri_pvem:c_prd_pt), any_vars(. != "-")) %>%
group_by(distrito)
cdmx_2015 %>%
select(distrito, c_pri_pvem, c_prd_pt) %>%
filter_at(vars(c_pri_pvem:c_prd_pt), any_vars(. == "-")) %>%
group_by(distrito)
cdmx_2015 %>%rm
select(seccion, distrito, cand_ind_1:cand_ind_2) %>%
filter_at(vars(cand_ind_1:cand_ind_2), any_vars(. != "-")) %>%
group_by(seccion)
cdmx_2015 %>%
select(seccion, distrito, cand_ind_1:cand_ind_2) %>%
filter_at(vars(cand_ind_1:cand_ind_2), any_vars(. != "-")) %>%
group_by(seccion)
#filter(cand_ind_2 != "-")
any(cdmx_2015$cand_ind_2 != "-")
cdmx_2015 <- cdmx_2015 %>%
mutate_at(vars(c_pri_pvem:cand_ind_1), arreglar_guiones) %>%
mutate_at(vars(c_pri_pvem:cand_ind_1),function(x) tryCatch(arreglar_guiones(x))) %>%
glimpse()
arreglar_guiones <- function(x){
return(ifelse((x == "-"), NA, x))
}
cdmx_2015 <- cdmx_2015 %>%
mutate_at(vars(c_pri_pvem:cand_ind_1), arreglar_guiones) %>%
mutate_at(vars(c_pri_pvem:cand_ind_1),function(x) tryCatch(arreglar_guiones(x))) %>%
glimpse()
cdmx_2015 <- cdmx_2015 %>%
mutate_at(vars(c_pri_pvem:cand_ind_1), arreglar_guiones) %>%
mutate_at(vars(c_pri_pvem:cand_ind_1),function(x) tryCatch(as.integer(x))) %>%
glimpse()
cdmx_2015 %>%
select(seccion, distrito, cand_ind_1:cand_ind_2) %>%
filter_at(vars(cand_ind_1:cand_ind_2), any_vars(. != "-")) %>%
group_by(seccion)
any(cdmx_2015$cand_ind_2 != "-")
cdmx_2015 <- cdmx_2015 %>%
select(-cand_ind_2)
arreglar_guiones <- function(x){
return(ifelse((x == "-"), NA, x))
}
cdmx_2015 <- cdmx_2015 %>%
mutate_at(vars(c_pri_pvem:cand_ind_1), arreglar_guiones) %>%
mutate_at(vars(c_pri_pvem:cand_ind_1),function(x) tryCatch(as.integer(x))) %>%
glimpse()
problematic_index <- problematic_data %>%
pull(row) %>%
unique() %>%
as.integer()
cdmx_2015 <- full_2015 %>%
filter(estado == 9) %>%
select(seccion, distrito, 12:28)
problematic_data <- problems(cdmx_2015)
number_automatic_problems <- problematic_data %>%
select(row) %>%
unique() %>%
nrow()
#¿En qué columnas hay problemas?
problematic_data %>% pull(col) %>% unique()
#¿Y en qué filas?
problematic_index <- problematic_data %>%
pull(row) %>%
unique() %>%
as.integer()
cdmx_2015[problematic_index,]
cdmx_2015 <- cdmx_2015 %>%
select(-cand_ind_2)
arreglar_guiones <- function(x){
return(ifelse((x == "-"), NA, x))
}
cdmx_2015 <- cdmx_2015 %>%
mutate_at(vars(c_pri_pvem:cand_ind_1), arreglar_guiones) %>%
mutate_at(vars(c_pri_pvem:cand_ind_1),function(x) tryCatch(as.integer(x))) %>%
glimpse()
cdmx_2015[problematic_index,]
problematic_index
names(full_2015)
full_2015[problematic_index,] %>%
select(observaciones) %>%
unique()
cdmx_2015[problematic_index,]
cdmx_2015[problematic_index,] %>%
filter_all(all_vars(is.na(.)))
cdmx_2015[problematic_index,] %>%
filter_all(all_vars(is.na(.))) %>%
nrow()
cdmx_2015[problematic_index,] %>%
filter_all(any_vars(!is.na(.))) %>%
nrow()
cdmx_2015[problematic_index,] %>%
filter_all(any_vars(!is.na(.)))
cdmx_2015 %>%
filter(seccion == 3685)
cdmx_2015 <- full_2015 %>%
filter(estado == 9) %>%
select(seccion, distrito, 12:28)
cdmx_2015 %>%
filter(seccion == 3685)
cdmx_2015 <- cdmx_2015 %>%
filter_all(all_vars(!is.na(.)))
cdmx_2015 <- cdmx_2015 %>%
filter_all(any_vars(!is.na(.)))
cdmx_2015 %>%
filter_all(any_vars(is.na(.)))
glimpe(cdmx_2015)
glimpse(cdmx_2015)
cdmx_2015 <- full_2015 %>%
filter(estado == 9) %>%
select(seccion, distrito, 12:28)
cdmx_2015[problematic_index,] %>%
filter_all(all_vars(is.na(.))) %>%
nrow()
cdmx_2015[problematic_index,] %>%
filter_all(all_vars(is.na(.))) %>%
nrow()
cdmx_2015[problematic_index,] %>%
filter_all(all_vars(is.na(.)))
cdmx_2015 %>%
filter_all(all_vars(!is.na(.)))
temp <- cdmx_2015 %>%
filter_all(all_vars(!is.na(.)))
temp <- cdmx_2015 %>%
filter_all(any_vars(!is.na(.)))
problematic_index[-1:2]
problematic_index[-c(1:2)]
cdmx_2015 <- cdmx_2015[problematic_index[-c(1:2)]]
cdmx_2015 <- cdmx_2015[problematic_index[-c(1:2)],]
cdmx_2015 <- full_2015 %>%
filter(estado == 9) %>%
select(seccion, distrito, 12:28)
cdmx_2015 %>%
filter_all(all_vars(!is.na(.)))
cdmx_2015 %>%
filter_all(all_vars(!is.na(.)))
temp[problematic_index]
temp[problematic_index,]
cdmx_2015 %>% filter_all(all_vars(is.na(.))
)
cdmx_2015[problematic_index,]
full_2015[problematic_index,] %>%
select(estado == 9)
full_2015[problematic_index,] %>%
select(estado == 9) %>%
filter_all(all_vars(is.na(.))) %>%
nrow()
full_2015
full_2015 <- read_delim("data/diputados_2015.csv", delim = "|", col_names = TRUE, skip = 5)
names(full_2015) <- full_2015 %>%
names() %>%
tolower()
cdmx_2015 <- full_2015 %>%
filter(estado == 9) %>%
select(seccion, distrito, 12:28)
cdmx_2015 <- full_2015 %>%
filter(estado == 9) %>%
select(seccion, distrito, 12:28)
problematic_data <- problems(cdmx_2015)
number_automatic_problems <- problematic_data %>%
select(row) %>%
unique() %>%
nrow()
problematic_index <- problematic_data %>%
pull(row) %>%
unique() %>%
as.integer()
names(full_2015)
full_2015[problematic_index,] %>%
filter(estado == 9) %>%
filter_all(all_vars(is.na(.))) %>%
nrow()
?subset
subset(full_2015, problematic_index)
?slice
full_2015 %>%
slice(problematic_index)
full_2015 %>%
slice(problematic_index) %>%
filter(estado == 9) %>%
select(seccion, distrito, 12:28)
full_2015 %>%
slice(problematic_index) %>%
filter(estado == 9)
full_2015 %>%
slice(problematic_index) %>%
pull(estado) %>%
unique() %>%
as.integer()
full_2015 %>%
slice(problematic_index) %>%
filter(estado == 9)
#¿Hubo coaliciones?
cdmx_2015 %>%
select(distrito, c_pri_pvem:c_prd_pt) %>%
filter_at(vars(c_pri_pvem:c_prd_pt), any_vars(. != "-")) %>%
group_by(distrito)
#En caso de que sí, ¿fue en todos los distritos?
cdmx_2015 %>%
select(distrito, c_pri_pvem, c_prd_pt) %>%
filter_at(vars(c_pri_pvem:c_prd_pt), any_vars(. == "-")) %>%
group_by(distrito)
cdmx_2015 %>%
select(seccion, distrito, cand_ind_1:cand_ind_2) %>%
filter_at(vars(cand_ind_1:cand_ind_2), any_vars(. != "-")) %>%
group_by(seccion)
any(cdmx_2015$cand_ind_2 != "-")
cdmx_2015 <- cdmx_2015 %>%
select(-cand_ind_2)
arreglar_guiones <- function(x){
return(ifelse((x == "-"), NA, x))
}
cdmx_2015 <- cdmx_2015 %>%
mutate_at(vars(c_pri_pvem:cand_ind_1), arreglar_guiones) %>%
mutate_at(vars(c_pri_pvem:cand_ind_1),function(x) tryCatch(as.integer(x))) %>%
glimpse()
cdmx_2015
glimpse(cdmx_2015)
n_votos <- sum(cdmx_2015$total_votos)
cdmx_2015
porcentajes <- cdmx_2015 %>%
select(-seccion, -estado, -distrito, -total_votos)
cdmx_2015 %>%
select(-seccion, -estado, -distrito, -total_votos)
porcentajes <- cdmx_2015 %>%
select(c("seccion", "estados", "distritos", "total_votos"))
porcentajes <- cdmx_2015 %>%
select(-c(seccion, estados, distritos, total_votos))
?select
cdmx_2015
cdmx_2015 %>%
select(-c(seccion, distrito, total_votos))
cdmx_2015 %>%
select(-c(seccion, distrito, total_votos)) %>%
colSums(na.rm = TRUE)
cdmx_2015 %>%
select(-c(seccion, distrito, total_votos)) %>%
colSums(na.rm = TRUE) %>%
n_votos
n_votos <- sum(cdmx_2015$total_votos)
?divide
?by
porcentajes <- cdmx_2015 %>%
select(-c(seccion, distrito, total_votos)) %>%
colSums(na.rm = TRUE)
porcentajes <- porcentajes / n_votos
sum(porcentajes)
porcentajes
porcentajes <- porcentajes / n_votos * 100
sum(porcentajes)
porcentajes <- porcentajes / n_votos * 100
porcentajes <- cdmx_2015 %>%
select(-c(seccion, distrito, total_votos)) %>%
colSums(na.rm = TRUE)
porcentajes <- (porcentajes / n_votos) * 100
sum(porcentajes)
porcentajes
porcentajes <- cdmx_2015 %>%
select(-c(seccion, distrito, total_votos)) %>%
colSums(na.rm = TRUE)  %>%
sort()
porcentajes <- (porcentajes / n_votos) * 100
porcentajes
?sort
porcentajes <- cdmx_2015 %>%
select(-c(seccion, distrito, total_votos)) %>%
colSums(na.rm = TRUE) %>%
/(n_votos) %>%
?/()
?+
()
?+()
?"+"
porcentajes <- cdmx_2015 %>%
select(-c(seccion, distrito, total_votos)) %>%
colSums(na.rm = TRUE) %>%
"/"(n_votos) %>%
"*"(100)
sum(porcentajes)
porcentajes
?sort
select(-c(seccion, distrito, total_votos)) %>%
colSums(na.rm = TRUE) %>%
"/"(n_votos) %>%
"*"(100) %>%
sort(decreasing = TRUE)
select(-c(seccion, distrito, total_votos)) %>%
colSums(na.rm = TRUE) %>%
"/"(n_votos) %>%
"*"(100) %>%
sort(decreasing = TRUE)
porcentajes <- cdmx_2015 %>%
select(-c(seccion, distrito, total_votos)) %>%
colSums(na.rm = TRUE) %>%
"/"(n_votos) %>%
"*"(100) %>%
sort(decreasing = TRUE)
porcentajes
?cumsum
cumsum(porcentajes)
cdmx_2015 %>% group_by(seccion)
porcentajes
glimpse(cdmx_2015)
